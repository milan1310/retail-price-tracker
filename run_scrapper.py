import os
import subprocess
from datetime import datetime
import pandas as pd
import glob

from celery_conf import celery

# spiders = ["amazon3p", "walmart3p"]
spiders = {
    # "amazon3p": "amazon_asin_numbers",
    "walmart3p": "walmart_product_ids_3p",
}
amazon_asin_numbers = [
    "B0BF792TG8",
    "B00JTUBPC4",
    "B07B5XYD7K",
    "B086R9GDV1",
    "B07GL4KW5Q",
    "B00JTUBP6U",
    "B08DM83GY6",
    "B07QQLFFYR",
    "B003EQ85IG",
    "B07GLGY2RY",
    "B08DM8G4JH",
    "B08DM98LPG",
    "B01DJZ8RUM",
    "B00BLKXTDS",
    "B00JTUBTQG",
    "B0006IBYSI",
    "B0B1H1D287",
    "B08DM8MH74",
    "B08DM6GNW2",
    "B00J00X7QK",
    "B07MXPNH7S",
    "B00I4E91GI",
    "B000COX0JM",
    "B00HG76A9A",
    "B00JTUBTU2",
    "B000SKV4U2",
    "B00LWUX2IY",
    "B08DM8CSPJ",
    "B08DM8ZFPQ",
    "B07C6P53YJ",
    "B007IOBM4E",
    "B083TQSYG7",
    "B07V1GZZ45",
    "B00J00X3NW",
    "B07Y5MG3MX",
    "B08DM8LJ5N",
    "B08CNHVSKB",
    "B07GKZ3KY2",
    "B000SM6OD2",
    "B08DM9JY4S",
    "B07GL2XDTG",
    "B07YVLLC3G",
    "B00R5BH2HQ",
    "B00JTUBP8I",
    "B00J00X5YO",
    "B08DM8WVCL",
    "B08DM7W29D",
]
walmart_product_ids = [
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-5w-30-1-quart/17034379",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-10w-40-5-quart/23636903",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-5w-30-5-quart/1222098962",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-30-1-quart/17128881",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-30-5-quart/17034353",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-0w-20-5-quart/55502866",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-5w-30-1-quart/17034360",
    "https://www.walmart.com/ip/mobil-1-hybrid-0w-20-5-quart-3-pack/1435221247",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-30-12-quart/675015365",
    "https://www.walmart.com/ip/mobil-1-v-twin-full-synthetic-motorcycle-oil-20w-50-1-quart/16767830",
    "https://www.walmart.com/ip/mobil-1-full-synthetic-lv-automatic-transmission-fluid-hp-1-quart/529024540",
    "https://www.walmart.com/ip/mobil-1-hybrid-0w-20-advanced-full-synthetic-motor-oil-5-quart/1435221247",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-0w-20-1-quart/177883659",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-5w-30-1-quart/17034377",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-synthetic-blend-diesel-engine-oil-15w-40-1-gallon-(pack-of-4)/137485527",
    "https://www.walmart.com/ip/mobil-1-racing-4t-full-synthetic-motorcycle-oil-10w-40-1-quart/641261380",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-30-5-quart/111569385",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-5w-20-5-quart/20971334",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-10w-30-1-gal/120391958",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-premium-synthetic-blend-diesel-engine-oil-15w-40-1-gallon/17034368",
    "https://www.walmart.com/ip/mobil-full-synthetic-high-mileage-motor-oil-5w-30-5-quart/463393784",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-5w-20-5-quart-(3-pack)/999673463",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-5w-30-5-quart/17034362",
    "https://www.walmart.com/ip/mobil-1-esp-full-synthetic-motor-oil-0w-30-5-quart/1756386056",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-5w-30-5-quart/17034366",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-15w-40-5-gallon/327035382",
    "https://www.walmart.com/ip/mobil-1-esp-full-synthetic-motor-oil-0w-40-1-quart/168610917",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-15w-40-1-gallon/319665447",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-20-12-quart/466895197",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-5w-20-1-quart/602483283",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-30-5-quart-(3-pack)/704494411",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-10w-30-1-quart/17034361",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-5w-20-1-quart/17034359",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-premium-synthetic-blend-diesel-engine-oil-15w-40-25-gallon/19864183",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-40-5-quart/17034354",
    "https://www.walmart.com/ip/mobil-full-synthetic-high-mileage-motor-oil-5w-20-5-quart/588086506",
    "https://www.walmart.com/ip/mobil-1-turbo-diesel-truck-full-synthetic-motor-oil-5w-40-1-quart/191438432",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-16-1-quart/805628775",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-0w-40-12-quart/893400295",
    "https://www.walmart.com/ip/mobil-full-synthetic-motor-oil-5w-30-5-quart/944831666",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-1-quart/17034375",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-5w-20-5-quart/20713646",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-30-1-quart/17034355",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-0w-20-1-quart/617412082",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-0w-20-5-quart/36019107",
    "https://www.walmart.com/ip/mobil-1-fs-x2-european-car-formula-full-synthetic-motor-oil-5w-50-1-quart/195514940",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-16-5-quart-(pack-of-3)/443826854",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-10w-30-1-quart/17034356",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-0w-20-5-quart/559561393",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-10w-30-1-quart/17034380",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-15w-40-25-gal/996900308",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-5w-30-1-quart/126368867",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-5-quart-(pack-of-3)/832480485",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-5w-20-5-quart/17034358",
    "https://www.walmart.com/ip/mobil-1-synthetic-gear-lubricant-ls-75w-140-1-quart/180526460",
    "https://www.walmart.com/ip/mobil-1-synthetic-gear-lubricant-ls-75w-90-1-quart/110167556",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-10w-40-1-quart/17034381",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-0w-20-1-quart/36019106",
    "https://www.walmart.com/ip/mobil-full-synthetic-high-mileage-motor-oil-0w-20-5-quart/889934073",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-10w-30-5-quart/17034382",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-10w-30-5-quart-(pack-of-3)/169396737",
    "https://www.walmart.com/ip/mobil-1-turbo-diesel-truck-full-synthetic-motor-oil-5w-40-1-gallon/17128879",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-40-5-quart-(pack-of-3)/536786747",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-30-5-quart-(pack-of-3)/888704636",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-15w-40-1-gal/928865372",
    "https://www.walmart.com/ip/mobil-full-synthetic-motor-oil-5w-20-5-quart/376994265",
    "https://www.walmart.com/ip/mobil-1-synthetic-grease-134-oz/113173738",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-20-5-quart/17018132",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-30-1-quart/158156370",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-20-12-quart/600074190",
    "https://www.walmart.com/ip/mobil-delvac-1-advanced-full-synthetic-gear-lubricant-75w-90-1-gallon/315481275",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-30-12-quart/383945284",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-5w-20-5-quart/55502862",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-0w-20-5-quart-(pack-of-3)/184017029",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-6-gallon/684022600",
    "https://www.walmart.com/ip/mobil-1-supercar-advanced-full-synthetic-motor-oil-0w-40-1-quart/168610917",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-5w-30-1-quart/5144655347",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-30-5-quart/17034372",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-20-6-gallon/120708203",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-5w-30-5-quart/17034383",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-30-1-quart/17034357",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-0w-20-1-quart/130935996",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-0w-40-5-quart/23636902",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-0w-40-5-quart-(pack-of-3)/742890295",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-0w-20-1-quart/750531090",
    "https://www.walmart.com/ip/mobil-1-esp-full-synthetic-motor-oil-0w-30-1-quart/185551668",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-30-5-quart/17018131",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-30-5-quart-(pack-of-3)/175346065",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-10w-30-5-quart/17034363",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-20-5-quart-(pack-of-3)/164533613",
    "https://www.walmart.com/ip/mobil-delvac-hdeo-15w-40-1-gal/422208868",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-30-5-quart-(pack-of-3)/436514185",
    "https://www.walmart.com/ip/mobil-super-high-mileage-synthetic-blend-motor-oil-10w-40-5-quart/17034381",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-premium-synthetic-blend-diesel-engine-oil-10w-30-1-gallon/501884686",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-0w-40-1-quart/17034373",
    "https://www.walmart.com/ip/mobil-delvac-1-esp-heavy-duty-full-synthetic-diesel-engine-oil-5w-40-1-gallon/167510327",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-15w-50-1-quart/20713645",
    "https://www.walmart.com/ip/mobil-1-esp-full-synthetic-motor-oil-5w-30-1-quart/515992934",
    "https://www.walmart.com/ip/mobil-1-synthetic-automatic-transmission-fluid-1-quart/143537399",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-5w-40-5-quart/437059473",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-10w-30-5-quart/17034367",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-20-5-quart-(3-pack)/669598778",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-0w-20-5-quart-(pack-of-3)/937064674",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-1-quart-(pack-of-6)/101167073",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-synthetic-blend-diesel-engine-oil-15w-40-5-gal/47655324",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-10w-30-5-quart/17128878",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-5w-40-1-quart/180823648",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-0w-20-1-quart/176781982",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-40-1-quart/17128882",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-20-1-quart/658331537",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-0w-20-5-quart/55502860",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-8-5-quart/5040310278",
    "https://www.walmart.com/ip/mobil-delvac-tractor-hydraulic-fluid-25-gallon/5023779487",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-12-quart/935258375",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-10w-30-5-quart/17034371",
    "https://www.walmart.com/ip/mobil-1-fs-european-car-formula-full-synthetic-motor-oil-5w-40-5-quart-(pack-of-3)/389304923",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-10w-30-1-quart/17034378",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-5w-20-5-quart/584989388",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-1-quart/17034375",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-0w-20-5-quart-(3-pack)/233854598",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-5w-20-5-quart/940504415",
    "https://www.walmart.com/ip/mobil-1-racing-full-synthetic-motor-oil-0w-50-1-quart/55502856",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-5w-30-5-quart/17128876",
    "https://www.walmart.com/ip/mobil-full-synthetic-motor-oil-0w-20-5-quart/733057972",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-16-5-quart/747116534",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-premium-synthetic-blend-diesel-engine-oil-15w-40-5-gallon/47655324",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-10w-40-1-quart/24519698",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-5w-30-5-quart/55502864",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-10w-30-5-quart-(pack-of-3)/601833861",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-20-1-quart/23636901",
    "https://www.walmart.com/ip/mobil-1-esp-x2-full-synthetic-motor-oil-0w-20-1-quart/277562810",
    "https://www.walmart.com/ip/mobil-1-hybrid-0w-20-advanced-full-synthetic-motor-oil-1-quart/1474287251",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-5w-30-5-quart/108197437",
    "https://www.walmart.com/ip/mobil-delvac-1300-super-heavy-duty-premium-synthetic-blend-diesel-engine-oil-15w-40-1-quart/20882267",
    "https://www.walmart.com/ip/mobil-1-racing-4t-full-synthetic-motorcycle-oil-10w-40-1-quart/16767829",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-30-5-quart/17034369",
    "https://www.walmart.com/ip/mobil-1-racing-full-synthetic-motor-oil-0w-30-1-quart/55502854",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-30-1-quart/17034370",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-20-1-quart/16767828",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-20-5-quart-(pack-of-3)/492282596",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-5w-30-1-quart-(pack-of-6)/125393517",
    "https://www.walmart.com/ip/mobil-1-truck-&-suv-full-synthetic-motor-oil-5w-30-1-quart/738110878",
    "https://www.walmart.com/ip/mobil-delvac-extreme-heavy-duty-full-synthetic-diesel-engine-oil-15w-40-1-gal/319665447",
    "https://www.walmart.com/ip/mobil-super-synthetic-blend-motor-oil-5w-20-1-quart/17034376",
    "https://www.walmart.com/ip/mobil-1-advanced-full-synthetic-motor-oil-15w-50-5-quart/20713647",
    "https://www.walmart.com/ip/mobil-1-extended-performance-high-mileage-full-synthetic-motor-oil-0w-20-5-quart/709883484",
    "https://www.walmart.com/ip/mobil-1-esp-x2-full-synthetic-motor-oil-0w-20-5-quart/5020133446",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-5w-30-1-quart/17128875",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-5w-20-1-quart/17128880",
    "https://www.walmart.com/ip/mobil-delvac-1-full-synthetic-automatic-transmission-fluid-1-gallon/850799380",
    "https://www.walmart.com/ip/mobil-1-extended-performance-full-synthetic-motor-oil-10w-30-1-quart/17128877",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-5w-20-5-quart/17034365",
    "https://www.walmart.com/ip/mobil-1-v-twin-full-synthetic-motorcycle-oil-20w-50-1-quart/387238312",
    "https://www.walmart.com/ip/mobil-1-annual-protection-full-synthetic-motor-oil-5w-20-1-quart/151446732",
    "https://www.walmart.com/ip/mobil-super-synthetic-motor-oil-0w-20-5-quart/168837928",
    "https://www.walmart.com/ip/mobil-1-high-mileage-full-synthetic-motor-oil-5w-20-5-quart/23636900",
    "https://www.walmart.com/ip/mobil-1-advanced-fuel-economy-full-synthetic-motor-oil-0w-20-5-quart/17034374",
]
walmart_product_ids_3p = [
    '17034379',
'16767830',
'437059473',
'17034367',
'47655324',
'17128878',
'180823648',
'176781982',
'17128882',
'529024540',
'658331537',
'5040310278',
'5023779487',
'935258375',
'17034371',
'17034378',
'584989388',
'17034375',
'1435221247',
'55502856',
'17128876',
'733057972',
'747116534',
'47655324',
'24519698',
'55502864',
'177883659',
'23636901',
'277562810',
'1474287251',
'20882267',
'16767829',
'17034369',
'55502854',
'17034370',
'16767828',
'17034377',
'319665447',
'17034376',
'20713647',
'709883484',
'5020133446',
'17128875',
'17128880',
'850799380',
'17128877',
'17034365',
'387238312',
'151446732',
'23636900',
'17034374',
'641261380',
'111569385',
'20971334',
'120391958',
'23636903',
'17034368',
'463393784',
'17034362',
'1756386056',
'17034366',
'327035382',
'168610917',
'319665447',
'466895197',
'1222098962',
'17034361',
'17034359',
'19864183',
'17034354',
'588086506',
'191438432',
'805628775',
'893400295',
'17128881',
'944831666',
'17034375',
'17034355',
'36019107',
'195514940',
'17034356',
'17034353',
'17034380',
'996900308',
'126368867',
'17034358',
'180526460',
'110167556',
'17034381',
'36019106',
'889934073',
'55502866',
'17034382',
'17128879',
'928865372',
'376994265',
'113173738',
'17018132',
'158156370',
'17034360',
'600074190',
'315481275',
'383945284',
'55502862',
'684022600',
'168610917',
'5144655347',
'17034372',
'120708203',
'1435221247',
'17034383',
'17034357',
'130935996',
'23636902',
'750531090',
'185551668',
'17018131',
'17034363',
'675015365',
'17034381',
'501884686',
'17034373',
'167510327',
'20713645',
'515992934',
'143537399'
]

def run_pdp_spider(spider, asin_number, n):
    print("--------------------------------")
    print(f"Running 3p for value: {asin_number}")
    cmd = f"scrapy crawl {spider} -a asin={asin_number} -o {spider}_{n}.csv --logfile walmart.log"
    subprocess.call(cmd, shell=True)
    print("--------------------------------")


@celery.task(bind=True)
def run_pdp(self):
    n = 1
    for spider, column in spiders.items():
        for asin_number in globals()[column]:
            run_pdp_spider(spider, asin_number, n)
            n += 1
    # for asin_number in walmart_product_ids_3p:
    #     run_pdp_spider("walmart3p", asin_number, n)
    #     n += 1
    # Get a list of all CSV files
        csv_files = glob.glob(f"{spider}_*.csv")
        dfs = []
        # Loop through the list of CSV files
        for csv_file in csv_files:
            if os.stat(csv_file).st_size != 0:
                df = pd.read_csv(csv_file, index_col=None, header=0)
                dfs.append(df)
            else:
                print(f"Skipping empty file: {csv_file}")    
        # Concatenate all dataframes in the list into a single dataframe
        merged_df = pd.concat(dfs, ignore_index=True)
        # Write the merged dataframe to a new CSV file
        merged_df.to_csv(
            f'./tmp/{spider}_{datetime.now().strftime("%Y-%m-%d")}.csv', index=False
        )
